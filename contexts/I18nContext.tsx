import createContextHook from '@nkzw/create-context-hook';
import AsyncStorage from '@react-native-async-storage/async-storage';
import { useCallback, useEffect, useMemo, useState } from 'react';

export type Locale = 'zh' | 'en' | 'es';

const LOCALE_STORAGE_KEY = 'app_locale';

type Messages = Record<string, string>;

const MESSAGES: Record<Locale, Messages> = {
  zh: {
    'common.cancel': '取消',
    'common.close': '关闭',
    'common.copy': '复制',
    'common.copied': '已复制',
    'common.ok': '确定',
    'common.refresh': '刷新',
    'common.back': '返回',
    'common.loading': '加载中...',
    'code.qrFailed': 'QR生成失败',
    'code.barcodeFailed': '条码生成失败',

    'tabs.home': '首页',
    'tabs.coupons': '卡券',
    'tabs.transactions': '账单',
    'tabs.profile': '我的',

    'tier.silver': '白银会员',
    'tier.gold': '黄金会员',
    'tier.platinum': '铂金会员',
    'tier.diamond': '钻石会员',

    'auth.subtitle': 'VIP会员中心',
    'auth.memberId': '会员ID',
    'auth.password': '密码',
    'auth.login': '登录',
    'auth.forgotPassword': '忘记密码?',
    'auth.register': '注册新会员',
    'auth.firstLoginHint': '首次登录请使用手机号注册',
    'auth.memberIdRequired': '请输入会员ID',
    'auth.passwordRequired': '请输入密码',
    'auth.loginFailed': '登录失败',
    'auth.invalidCredentials': '会员ID或密码错误',

    'home.welcomeBack': '欢迎回来',
    'home.balance': '账户余额',
    'home.memberId': '会员ID',
    'home.points': '积分',
    'home.action.recharge': '充值',
    'home.action.coupons': '卡券',
    'home.action.transactions': '账单',
    'home.action.memberCode': '付款码',
    'home.recentTransactions': '最近交易',
    'home.seeAll': '查看全部',
    'home.promoTitle': '会员日特惠',
    'home.promoDesc': '每周三充值享双倍积分',
    'home.promoCta': '立即参与',
    'home.barcodeFailed': '条码生成失败',
    'home.loginToShowBarcode': '登录查看条码',

    'transactions.title': '交易记录',
    'transactions.totalDeposit': '累计充值',
    'transactions.totalSpend': '累计消费',
    'transactions.filter.all': '全部',
    'transactions.filter.deposit': '充值',
    'transactions.filter.spend': '消费',
    'transactions.filter.bonus': '赠送',
    'transactions.empty': '暂无交易记录',
    'transactions.noTransactions': '暂无交易记录',
    'transactions.loginRequired': '请先登录查看交易记录',
    'transactions.balancePrefix': '余额',

    'memberCode.title': '会员码',
    'memberCode.memberCardNo': '会员卡号',
    'memberCode.showToCashier': '付款时请向收银员出示此码',
    'memberCode.balance': '账户余额',
    'memberCode.points': '可用积分',
    'memberCode.pleaseLoginFirst': '请先登录',

    'weekday.mon': '周一',
    'weekday.tue': '周二',
    'weekday.wed': '周三',
    'weekday.thu': '周四',
    'weekday.fri': '周五',
    'weekday.sat': '周六',
    'weekday.sun': '周日',

    'locations.title': '门店地址',
    'locations.openInMaps': '打开地图',
    'locations.address': '地址',
    'locations.locatedAt': '位于：{place}',
    'locations.hours': '营业时间',
    'locations.website': '官网',
    'locations.phone': '电话',

    'coupons.title': '卡券钱包',
    'coupons.segment.available': '可用',
    'coupons.segment.used': '已使用',
    'coupons.segment.expired': '已过期',
    'coupons.section.offers': '可领取',
    'coupons.empty.available': '暂无可用卡券',
    'coupons.empty.used': '暂无已使用卡券',
    'coupons.empty.expired': '暂无已过期卡券',
    'coupons.claim': '领取',
    'coupons.claimed': '已领取',
    'coupons.locked': '未解锁',
    'coupons.requiresTier': '需 {tier}',
    'coupons.validTo': '有效期至 {date}',

    'couponDetail.title': '卡券详情',
    'couponDetail.redeemHint': '到店核销时出示二维码/条形码',
    'couponDetail.markUsed': '标记为已使用',
    'couponDetail.used': '已使用',
    'couponDetail.expired': '已过期',
    'couponDetail.notClaimed': '未领取',
    'couponDetail.codeLabel': '核销码',

    'profile.title': '我的',
    'profile.memberId': '会员ID',
    'profile.phone': '手机号',
    'profile.joinDate': '入会日期',
    'profile.section.account': '账户设置',
    'profile.section.support': '服务支持',
    'profile.item.notifications': '消息通知',
    'profile.item.security': '账户安全',
    'profile.item.preferences': '偏好设置',
    'profile.item.nearbyStores': '附近门店',
    'profile.item.supportChat': '在线客服',
    'profile.item.helpCenter': '帮助中心',
    'profile.logout': '退出登录',
    'profile.logoutConfirmTitle': '退出登录',
    'profile.logoutConfirmMessage': '确定要退出当前账号吗？',
    'profile.version': '版本 {version}',

    'notFound.title': '页面未找到',
    'notFound.message': '页面不存在',
    'notFound.backHome': '返回首页',

    'recharge.title': '充值',
    'recharge.currentBalance': '当前余额',
    'recharge.selectAmount': '选择充值金额',
    'recharge.customAmount': '自定义金额',
    'recharge.customPlaceholder': '输入金额',
    'recharge.minHint': '最低充值金额 ¥50',
    'recharge.rechargeAmount': '充值金额',
    'recharge.bonusAmount': '赠送金额',
    'recharge.totalCredit': '实际到账',
    'recharge.confirmButton': '确认充值',
    'recharge.error': '提示',
    'recharge.minAmount': '最低充值金额为50元',
    'recharge.confirmTitle': '确认充值',
    'recharge.confirmMessage': '确认充值 ¥{amount}？',
    'recharge.success': '充值成功',
    'recharge.successMessage': '充值金额已到账',

    'promo.title': '会员活动',
    'promo.heroTitle': '会员日特惠',
    'promo.heroDesc': '每周三充值享双倍积分，更有神秘大礼等你来拿！',
    'promo.heroTime': '每周三全天',
    'promo.currentPromos': '当前活动',
    'promo.item.wednesday.title': '周三双倍积分',
    'promo.item.wednesday.desc': '每周三充值可获得双倍积分',
    'promo.item.newMember.title': '新会员礼包',
    'promo.item.newMember.desc': '首次充值满500送100',
    'promo.item.birthday.title': '生日特权',
    'promo.item.birthday.desc': '生日当月消费享8折优惠',
    'promo.rulesTitle': '活动规则',
    'promo.rule1': '活动仅限VIP会员参与',
    'promo.rule2': '积分奖励将在充值后24小时内到账',
    'promo.rule3': '赠送金额不可提现，仅限消费使用',
    'promo.rule4': '最终解释权归十秒到所有',
    'promo.ctaButton': '立即充值',

    'forgot.phoneTitle': '找回密码',
    'forgot.phoneSubtitle': '请输入注册时使用的手机号',
    'forgot.phonePlaceholder': '请输入手机号',
    'forgot.sendCode': '获取验证码',
    'forgot.codeTitle': '输入验证码',
    'forgot.codeSubtitle': '验证码已发送至尾号{phone}的手机',
    'forgot.verify': '验证',
    'forgot.resend': '重新发送',
    'forgot.resendIn': '{seconds}秒后重发',
    'forgot.successTitle': '验证成功',
    'forgot.successSubtitle': '您的临时密码如下，请登录后修改',
    'forgot.tempPassword': '临时密码',
    'forgot.backToLogin': '返回登录',
    'forgot.error': '提示',
    'forgot.invalidPhone': '请输入有效的手机号',
    'forgot.invalidCode': '请输入有效的验证码',

    'register.title': '注册新会员',
    'register.subtitle': '加入十秒到会员，享受专属优惠',
    'register.namePlaceholder': '请输入姓名',
    'register.phonePlaceholder': '请输入手机号',
    'register.passwordPlaceholder': '设置密码（至少6位）',
    'register.confirmPasswordPlaceholder': '确认密码',
    'register.agreePrefix': '我已阅读并同意',
    'register.terms': '《服务条款》',
    'register.and': '和',
    'register.privacy': '《隐私政策》',
    'register.submit': '立即注册',
    'register.hasAccount': '已有账号？',
    'register.loginNow': '立即登录',
    'register.error': '提示',
    'register.nameRequired': '请输入姓名',
    'register.phoneInvalid': '请输入有效的手机号',
    'register.passwordWeak': '密码至少6位',
    'register.passwordMismatch': '两次密码输入不一致',
    'register.agreeRequired': '请同意服务条款和隐私政策',
    'register.successTitle': '注册成功',
    'register.successMessage': '您的会员ID将通过短信发送，请查收',

    'notifications.title': '消息通知',
    'notifications.settingsTitle': '通知设置',
    'notifications.transactions': '交易通知',
    'notifications.promotions': '优惠活动',
    'notifications.announcements': '系统公告',
    'notifications.messages': '客服消息',
    'notifications.recentTitle': '最近消息',
    'notifications.empty': '暂无消息',
    'notifications.item.promo.title': '会员日特惠',
    'notifications.item.promo.desc': '周三充值享双倍积分，立即参与！',
    'notifications.item.transaction.title': '消费成功',
    'notifications.item.transaction.desc': '您在门店消费了¥128.00',
    'notifications.item.system.title': '系统更新',
    'notifications.item.system.desc': 'APP已更新至最新版本，体验更流畅',

    'security.title': '账户安全',
    'security.accountSection': '账户密码',
    'security.loginPassword': '登录密码',
    'security.loginPasswordHint': '定期修改密码更安全',
    'security.paymentPassword': '支付密码',
    'security.paymentPasswordDesc': '用于消费时验证身份',
    'security.paymentPasswordHint': '设置6位数字支付密码',
    'security.changePassword': '修改密码',
    'security.changePasswordHint': '请前往门店或联系客服修改密码',
    'security.privacySection': '隐私设置',
    'security.biometric': '生物识别',
    'security.biometricHint': '使用面容/指纹快速登录',
    'security.hideBalance': '隐藏余额',
    'security.hideBalanceHint': '在首页隐藏账户余额',
    'security.devicesSection': '设备管理',
    'security.linkedDevices': '已登录设备',
    'security.linkedDevicesDesc': '管理已登录的设备',
    'security.linkedDevicesHint': '当前仅有1台设备登录',
    'security.tipText': '您的账户安全等级良好，请继续保持',

    'preferences.title': '偏好设置',
    'preferences.displaySection': '显示设置',
    'preferences.darkMode': '深色模式',
    'preferences.language': '语言',
    'preferences.soundSection': '声音与震动',
    'preferences.sound': '提示音',
    'preferences.vibration': '震动反馈',

    'stores.title': '附近门店',
    'stores.currentLocation': '当前位置：上海市',
    'stores.store1.name': '十秒到（南京路店）',
    'stores.store1.address': '上海市黄浦区南京东路100号',
    'stores.store2.name': '十秒到（陆家嘴店）',
    'stores.store2.address': '上海市浦东新区陆家嘴环路200号',
    'stores.store3.name': '十秒到（徐家汇店）',
    'stores.store3.address': '上海市徐汇区华山路300号',
    'stores.call': '拨打电话',
    'stores.navigate': '导航',

    'support.title': '在线客服',
    'support.online': '在线',
    'support.welcomeMessage': '您好！我是十秒到智能客服小秒，请问有什么可以帮您？',
    'support.autoReply': '感谢您的咨询，人工客服正在接入中，请稍候...',
    'support.quickTitle': '猜您想问',
    'support.quick.balance': '如何查询余额？',
    'support.quick.recharge': '充值有什么优惠？',
    'support.quick.coupon': '优惠券怎么使用？',
    'support.quick.points': '积分如何兑换？',
    'support.inputPlaceholder': '请输入您的问题...',

    'help.title': '帮助中心',
    'help.heroTitle': '有什么可以帮您？',
    'help.heroSubtitle': '在这里查找常见问题的答案',
    'help.faqTitle': '常见问题',
    'help.faq.recharge.q': '如何充值？',
    'help.faq.recharge.a': '您可以在首页点击"充值"按钮，选择金额后完成支付即可。充值成功后，金额会立即到账。',
    'help.faq.coupon.q': '优惠券如何使用？',
    'help.faq.coupon.a': '在"卡券"页面查看可用优惠券，消费时向收银员出示优惠券二维码即可使用。',
    'help.faq.points.q': '积分有什么用？',
    'help.faq.points.a': '积分可用于兑换优惠券、礼品等。每消费1元可获得1积分，充值还可获得额外积分奖励。',
    'help.faq.tier.q': '会员等级如何升级？',
    'help.faq.tier.a': '根据累计消费金额自动升级。银卡0-999元，金卡1000-4999元，铂金5000-9999元，钻石10000元以上。',
    'help.faq.password.q': '忘记密码怎么办？',
    'help.faq.password.a': '在登录页面点击"忘记密码"，通过注册手机号验证后可重置密码。',
    'help.stillNeedHelp': '没找到答案？',
    'help.contactSupport': '联系在线客服',
  },
  en: {
    'common.cancel': 'Cancel',
    'common.close': 'Close',
    'common.copy': 'Copy',
    'common.copied': 'Copied',
    'common.ok': 'OK',
    'common.refresh': 'Refresh',
    'common.back': 'Back',
    'common.loading': 'Loading...',
    'code.qrFailed': 'QR generation failed',
    'code.barcodeFailed': 'Barcode generation failed',

    'tabs.home': 'Home',
    'tabs.coupons': 'Coupons',
    'tabs.transactions': 'Bills',
    'tabs.profile': 'Me',

    'tier.silver': 'Silver',
    'tier.gold': 'Gold',
    'tier.platinum': 'Platinum',
    'tier.diamond': 'Diamond',

    'auth.subtitle': 'VIP Member Center',
    'auth.memberId': 'Member ID',
    'auth.password': 'Password',
    'auth.login': 'Sign in',
    'auth.forgotPassword': 'Forgot password?',
    'auth.register': 'Create account',
    'auth.firstLoginHint': 'First time? Register with your phone number.',
    'auth.memberIdRequired': 'Please enter Member ID',
    'auth.passwordRequired': 'Please enter password',
    'auth.loginFailed': 'Sign-in failed',
    'auth.invalidCredentials': 'Incorrect Member ID or password',

    'home.welcomeBack': 'Welcome back',
    'home.balance': 'Balance',
    'home.memberId': 'Member ID',
    'home.points': 'Points',
    'home.action.recharge': 'Top up',
    'home.action.coupons': 'Coupons',
    'home.action.transactions': 'Bills',
    'home.action.memberCode': 'Code',
    'home.recentTransactions': 'Recent transactions',
    'home.seeAll': 'See all',
    'home.promoTitle': 'Member Day Deal',
    'home.promoDesc': 'Double points on top-ups every Wednesday',
    'home.promoCta': 'Join now',
    'home.barcodeFailed': 'Barcode failed',
    'home.loginToShowBarcode': 'Login to show barcode',

    'transactions.title': 'Transactions',
    'transactions.totalDeposit': 'Total top-up',
    'transactions.totalSpend': 'Total spend',
    'transactions.filter.all': 'All',
    'transactions.filter.deposit': 'Top-up',
    'transactions.filter.spend': 'Spend',
    'transactions.filter.bonus': 'Bonus',
    'transactions.empty': 'No transactions yet',
    'transactions.noTransactions': 'No transactions yet',
    'transactions.loginRequired': 'Please sign in to view transactions',
    'transactions.balancePrefix': 'Balance',

    'memberCode.title': 'Member Code',
    'memberCode.memberCardNo': 'Card No.',
    'memberCode.showToCashier': 'Show this code at checkout',
    'memberCode.balance': 'Balance',
    'memberCode.points': 'Points',
    'memberCode.pleaseLoginFirst': 'Please sign in first',

    'weekday.mon': 'Mon',
    'weekday.tue': 'Tue',
    'weekday.wed': 'Wed',
    'weekday.thu': 'Thu',
    'weekday.fri': 'Fri',
    'weekday.sat': 'Sat',
    'weekday.sun': 'Sun',

    'locations.title': 'Location',
    'locations.openInMaps': 'Maps',
    'locations.address': 'Address',
    'locations.locatedAt': 'Located at {place}',
    'locations.hours': 'Hours',
    'locations.website': 'Website',
    'locations.phone': 'Phone',

    'coupons.title': 'Coupon Wallet',
    'coupons.segment.available': 'Available',
    'coupons.segment.used': 'Used',
    'coupons.segment.expired': 'Expired',
    'coupons.section.offers': 'Offers',
    'coupons.empty.available': 'No available coupons',
    'coupons.empty.used': 'No used coupons',
    'coupons.empty.expired': 'No expired coupons',
    'coupons.claim': 'Claim',
    'coupons.claimed': 'Claimed',
    'coupons.locked': 'Locked',
    'coupons.requiresTier': 'Requires {tier}',
    'coupons.validTo': 'Valid until {date}',

    'couponDetail.title': 'Coupon Details',
    'couponDetail.redeemHint': 'Show QR/barcode to redeem in store',
    'couponDetail.markUsed': 'Mark as used',
    'couponDetail.used': 'Used',
    'couponDetail.expired': 'Expired',
    'couponDetail.notClaimed': 'Not claimed',
    'couponDetail.codeLabel': 'Redeem code',

    'profile.title': 'Me',
    'profile.memberId': 'Member ID',
    'profile.phone': 'Phone',
    'profile.joinDate': 'Join date',
    'profile.section.account': 'Account',
    'profile.section.support': 'Support',
    'profile.item.notifications': 'Notifications',
    'profile.item.security': 'Security',
    'profile.item.preferences': 'Preferences',
    'profile.item.nearbyStores': 'Nearby stores',
    'profile.item.supportChat': 'Support chat',
    'profile.item.helpCenter': 'Help center',
    'profile.logout': 'Sign out',
    'profile.logoutConfirmTitle': 'Sign out',
    'profile.logoutConfirmMessage': 'Sign out of this account?',
    'profile.version': 'Version {version}',

    'notFound.title': 'Not Found',
    'notFound.message': 'This page does not exist',
    'notFound.backHome': 'Go home',

    'recharge.title': 'Top up',
    'recharge.currentBalance': 'Current balance',
    'recharge.selectAmount': 'Select amount',
    'recharge.customAmount': 'Custom amount',
    'recharge.customPlaceholder': 'Enter amount',
    'recharge.minHint': 'Minimum top-up amount ¥50',
    'recharge.rechargeAmount': 'Top-up amount',
    'recharge.bonusAmount': 'Bonus amount',
    'recharge.totalCredit': 'Total credit',
    'recharge.confirmButton': 'Confirm top-up',
    'recharge.error': 'Notice',
    'recharge.minAmount': 'Minimum top-up amount is ¥50',
    'recharge.confirmTitle': 'Confirm top-up',
    'recharge.confirmMessage': 'Confirm top-up of ¥{amount}?',
    'recharge.success': 'Success',
    'recharge.successMessage': 'Top-up amount has been credited',

    'promo.title': 'Promotions',
    'promo.heroTitle': 'Member Day Deal',
    'promo.heroDesc': 'Double points on top-ups every Wednesday, plus mystery gifts!',
    'promo.heroTime': 'Every Wednesday',
    'promo.currentPromos': 'Current promotions',
    'promo.item.wednesday.title': 'Wednesday Double Points',
    'promo.item.wednesday.desc': 'Get double points on Wednesday top-ups',
    'promo.item.newMember.title': 'New Member Gift',
    'promo.item.newMember.desc': 'First top-up ¥500 get ¥100 bonus',
    'promo.item.birthday.title': 'Birthday Privilege',
    'promo.item.birthday.desc': '20% off during your birthday month',
    'promo.rulesTitle': 'Rules',
    'promo.rule1': 'VIP members only',
    'promo.rule2': 'Points credited within 24 hours',
    'promo.rule3': 'Bonus cannot be withdrawn',
    'promo.rule4': 'Final interpretation rights reserved',
    'promo.ctaButton': 'Top up now',

    'forgot.phoneTitle': 'Reset Password',
    'forgot.phoneSubtitle': 'Enter your registered phone number',
    'forgot.phonePlaceholder': 'Phone number',
    'forgot.sendCode': 'Send code',
    'forgot.codeTitle': 'Enter code',
    'forgot.codeSubtitle': 'Code sent to phone ending in {phone}',
    'forgot.verify': 'Verify',
    'forgot.resend': 'Resend',
    'forgot.resendIn': 'Resend in {seconds}s',
    'forgot.successTitle': 'Verified',
    'forgot.successSubtitle': 'Your temporary password is below',
    'forgot.tempPassword': 'Temporary password',
    'forgot.backToLogin': 'Back to login',
    'forgot.error': 'Notice',
    'forgot.invalidPhone': 'Please enter a valid phone number',
    'forgot.invalidCode': 'Please enter a valid code',

    'register.title': 'Create Account',
    'register.subtitle': 'Join and enjoy exclusive benefits',
    'register.namePlaceholder': 'Full name',
    'register.phonePlaceholder': 'Phone number',
    'register.passwordPlaceholder': 'Password (min 6 characters)',
    'register.confirmPasswordPlaceholder': 'Confirm password',
    'register.agreePrefix': 'I agree to the',
    'register.terms': 'Terms of Service',
    'register.and': 'and',
    'register.privacy': 'Privacy Policy',
    'register.submit': 'Create account',
    'register.hasAccount': 'Already have an account?',
    'register.loginNow': 'Sign in',
    'register.error': 'Notice',
    'register.nameRequired': 'Please enter your name',
    'register.phoneInvalid': 'Please enter a valid phone number',
    'register.passwordWeak': 'Password must be at least 6 characters',
    'register.passwordMismatch': 'Passwords do not match',
    'register.agreeRequired': 'Please agree to the terms',
    'register.successTitle': 'Registration successful',
    'register.successMessage': 'Your member ID will be sent via SMS',

    'notifications.title': 'Notifications',
    'notifications.settingsTitle': 'Settings',
    'notifications.transactions': 'Transactions',
    'notifications.promotions': 'Promotions',
    'notifications.announcements': 'Announcements',
    'notifications.messages': 'Messages',
    'notifications.recentTitle': 'Recent',
    'notifications.empty': 'No notifications',
    'notifications.item.promo.title': 'Member Day Deal',
    'notifications.item.promo.desc': 'Double points on Wednesday top-ups!',
    'notifications.item.transaction.title': 'Payment successful',
    'notifications.item.transaction.desc': 'You spent ¥128.00 at store',
    'notifications.item.system.title': 'System update',
    'notifications.item.system.desc': 'App updated to latest version',

    'security.title': 'Security',
    'security.accountSection': 'Account',
    'security.loginPassword': 'Login password',
    'security.loginPasswordHint': 'Change password regularly',
    'security.paymentPassword': 'Payment password',
    'security.paymentPasswordDesc': 'Verify identity for payments',
    'security.paymentPasswordHint': 'Set 6-digit payment password',
    'security.changePassword': 'Change password',
    'security.changePasswordHint': 'Visit store or contact support',
    'security.privacySection': 'Privacy',
    'security.biometric': 'Biometric login',
    'security.biometricHint': 'Use Face ID/fingerprint',
    'security.hideBalance': 'Hide balance',
    'security.hideBalanceHint': 'Hide balance on home screen',
    'security.devicesSection': 'Devices',
    'security.linkedDevices': 'Linked devices',
    'security.linkedDevicesDesc': 'Manage logged-in devices',
    'security.linkedDevicesHint': '1 device currently logged in',
    'security.tipText': 'Your account security is good',

    'preferences.title': 'Preferences',
    'preferences.displaySection': 'Display',
    'preferences.darkMode': 'Dark mode',
    'preferences.language': 'Language',
    'preferences.soundSection': 'Sound & Haptics',
    'preferences.sound': 'Sound',
    'preferences.vibration': 'Vibration',

    'stores.title': 'Nearby Stores',
    'stores.currentLocation': 'Current location: Shanghai',
    'stores.store1.name': 'Shí Miǎo Dào (Nanjing Rd)',
    'stores.store1.address': '100 Nanjing East Rd, Huangpu',
    'stores.store2.name': 'Shí Miǎo Dào (Lujiazui)',
    'stores.store2.address': '200 Lujiazui Ring Rd, Pudong',
    'stores.store3.name': 'Shí Miǎo Dào (Xujiahui)',
    'stores.store3.address': '300 Huashan Rd, Xuhui',
    'stores.call': 'Call',
    'stores.navigate': 'Navigate',

    'support.title': 'Support',
    'support.online': 'Online',
    'support.welcomeMessage': 'Hi! I\'m the support assistant. How can I help you?',
    'support.autoReply': 'Thanks for your message. A representative will be with you shortly...',
    'support.quickTitle': 'Quick questions',
    'support.quick.balance': 'How to check balance?',
    'support.quick.recharge': 'Any top-up offers?',
    'support.quick.coupon': 'How to use coupons?',
    'support.quick.points': 'How to redeem points?',
    'support.inputPlaceholder': 'Type your message...',

    'help.title': 'Help Center',
    'help.heroTitle': 'How can we help?',
    'help.heroSubtitle': 'Find answers to common questions',
    'help.faqTitle': 'FAQ',
    'help.faq.recharge.q': 'How to top up?',
    'help.faq.recharge.a': 'Tap "Top up" on home screen, select amount and complete payment. Balance is credited instantly.',
    'help.faq.coupon.q': 'How to use coupons?',
    'help.faq.coupon.a': 'View available coupons in "Coupons" tab. Show the QR code to cashier when paying.',
    'help.faq.points.q': 'What are points for?',
    'help.faq.points.a': 'Points can be redeemed for coupons and gifts. Earn 1 point per ¥1 spent, plus bonus points on top-ups.',
    'help.faq.tier.q': 'How to upgrade tier?',
    'help.faq.tier.a': 'Auto-upgrade based on spending: Silver 0-999, Gold 1000-4999, Platinum 5000-9999, Diamond 10000+.',
    'help.faq.password.q': 'Forgot password?',
    'help.faq.password.a': 'Tap "Forgot password" on login screen to reset via phone verification.',
    'help.stillNeedHelp': 'Still need help?',
    'help.contactSupport': 'Contact support',
  },
  es: {
    'common.cancel': 'Cancelar',
    'common.close': 'Cerrar',
    'common.copy': 'Copiar',
    'common.copied': 'Copiado',
    'common.ok': 'Aceptar',
    'common.refresh': 'Actualizar',
    'common.back': 'Atrás',
    'common.loading': 'Cargando...',
    'code.qrFailed': 'Error al generar el QR',
    'code.barcodeFailed': 'Error al generar el código de barras',

    'tabs.home': 'Inicio',
    'tabs.coupons': 'Cupones',
    'tabs.transactions': 'Movimientos',
    'tabs.profile': 'Yo',

    'tier.silver': 'Plata',
    'tier.gold': 'Oro',
    'tier.platinum': 'Platino',
    'tier.diamond': 'Diamante',

    'auth.subtitle': 'Centro VIP',
    'auth.memberId': 'ID de miembro',
    'auth.password': 'Contraseña',
    'auth.login': 'Iniciar sesión',
    'auth.forgotPassword': '¿Olvidaste la contraseña?',
    'auth.register': 'Crear cuenta',
    'auth.firstLoginHint': '¿Primera vez? Regístrate con tu número de teléfono.',
    'auth.memberIdRequired': 'Ingresa el ID de miembro',
    'auth.passwordRequired': 'Ingresa la contraseña',
    'auth.loginFailed': 'Error al iniciar sesión',
    'auth.invalidCredentials': 'ID de miembro o contraseña incorrectos',

    'home.welcomeBack': 'Bienvenido de nuevo',
    'home.balance': 'Saldo',
    'home.memberId': 'ID de miembro',
    'home.points': 'Puntos',
    'home.action.recharge': 'Recargar',
    'home.action.coupons': 'Cupones',
    'home.action.transactions': 'Movimientos',
    'home.action.memberCode': 'Código',
    'home.recentTransactions': 'Transacciones recientes',
    'home.seeAll': 'Ver todo',
    'home.promoTitle': 'Oferta del día de miembros',
    'home.promoDesc': 'Doble puntos en recargas todos los miércoles',
    'home.promoCta': 'Participar',
    'home.barcodeFailed': 'Error en código',
    'home.loginToShowBarcode': 'Inicia sesión para ver',

    'transactions.title': 'Transacciones',
    'transactions.totalDeposit': 'Total recargado',
    'transactions.totalSpend': 'Total gastado',
    'transactions.filter.all': 'Todo',
    'transactions.filter.deposit': 'Recarga',
    'transactions.filter.spend': 'Gasto',
    'transactions.filter.bonus': 'Bono',
    'transactions.empty': 'Aún no hay transacciones',
    'transactions.noTransactions': 'Aún no hay transacciones',
    'transactions.loginRequired': 'Inicia sesión para ver transacciones',
    'transactions.balancePrefix': 'Saldo',

    'memberCode.title': 'Código de miembro',
    'memberCode.memberCardNo': 'N.º de tarjeta',
    'memberCode.showToCashier': 'Muestra este código al pagar',
    'memberCode.balance': 'Saldo',
    'memberCode.points': 'Puntos',
    'memberCode.pleaseLoginFirst': 'Inicia sesión primero',

    'weekday.mon': 'Lun',
    'weekday.tue': 'Mar',
    'weekday.wed': 'Mié',
    'weekday.thu': 'Jue',
    'weekday.fri': 'Vie',
    'weekday.sat': 'Sáb',
    'weekday.sun': 'Dom',

    'locations.title': 'Ubicación',
    'locations.openInMaps': 'Mapa',
    'locations.address': 'Dirección',
    'locations.locatedAt': 'En {place}',
    'locations.hours': 'Horario',
    'locations.website': 'Sitio web',
    'locations.phone': 'Teléfono',

    'coupons.title': 'Billetera de cupones',
    'coupons.segment.available': 'Disponibles',
    'coupons.segment.used': 'Usados',
    'coupons.segment.expired': 'Vencidos',
    'coupons.section.offers': 'Ofertas',
    'coupons.empty.available': 'No hay cupones disponibles',
    'coupons.empty.used': 'No hay cupones usados',
    'coupons.empty.expired': 'No hay cupones vencidos',
    'coupons.claim': 'Obtener',
    'coupons.claimed': 'Obtenido',
    'coupons.locked': 'Bloqueado',
    'coupons.requiresTier': 'Requiere {tier}',
    'coupons.validTo': 'Válido hasta {date}',

    'couponDetail.title': 'Detalle del cupón',
    'couponDetail.redeemHint': 'Muestra el QR/código de barras para canjear en tienda',
    'couponDetail.markUsed': 'Marcar como usado',
    'couponDetail.used': 'Usado',
    'couponDetail.expired': 'Vencido',
    'couponDetail.notClaimed': 'No obtenido',
    'couponDetail.codeLabel': 'Código de canje',

    'profile.title': 'Yo',
    'profile.memberId': 'ID de miembro',
    'profile.phone': 'Teléfono',
    'profile.joinDate': 'Fecha de alta',
    'profile.section.account': 'Cuenta',
    'profile.section.support': 'Soporte',
    'profile.item.notifications': 'Notificaciones',
    'profile.item.security': 'Seguridad',
    'profile.item.preferences': 'Preferencias',
    'profile.item.nearbyStores': 'Tiendas cercanas',
    'profile.item.supportChat': 'Chat de soporte',
    'profile.item.helpCenter': 'Centro de ayuda',
    'profile.logout': 'Cerrar sesión',
    'profile.logoutConfirmTitle': 'Cerrar sesión',
    'profile.logoutConfirmMessage': '¿Cerrar sesión de esta cuenta?',
    'profile.version': 'Versión {version}',

    'notFound.title': 'No encontrado',
    'notFound.message': 'Esta página no existe',
    'notFound.backHome': 'Volver al inicio',

    'recharge.title': 'Recargar',
    'recharge.currentBalance': 'Saldo actual',
    'recharge.selectAmount': 'Seleccionar monto',
    'recharge.customAmount': 'Monto personalizado',
    'recharge.customPlaceholder': 'Ingrese monto',
    'recharge.minHint': 'Monto mínimo de recarga ¥50',
    'recharge.rechargeAmount': 'Monto de recarga',
    'recharge.bonusAmount': 'Monto de bonificación',
    'recharge.totalCredit': 'Crédito total',
    'recharge.confirmButton': 'Confirmar recarga',
    'recharge.error': 'Aviso',
    'recharge.minAmount': 'Monto mínimo de recarga es ¥50',
    'recharge.confirmTitle': 'Confirmar recarga',
    'recharge.confirmMessage': '¿Confirmar recarga de ¥{amount}?',
    'recharge.success': 'Éxito',
    'recharge.successMessage': 'El monto ha sido acreditado',

    'promo.title': 'Promociones',
    'promo.heroTitle': 'Oferta del día de miembros',
    'promo.heroDesc': '¡Doble puntos en recargas cada miércoles, más regalos misteriosos!',
    'promo.heroTime': 'Cada miércoles',
    'promo.currentPromos': 'Promociones actuales',
    'promo.item.wednesday.title': 'Miércoles doble puntos',
    'promo.item.wednesday.desc': 'Obtén doble puntos en recargas los miércoles',
    'promo.item.newMember.title': 'Regalo nuevo miembro',
    'promo.item.newMember.desc': 'Primera recarga ¥500 obtiene ¥100 bonus',
    'promo.item.birthday.title': 'Privilegio de cumpleaños',
    'promo.item.birthday.desc': '20% descuento en tu mes de cumpleaños',
    'promo.rulesTitle': 'Reglas',
    'promo.rule1': 'Solo miembros VIP',
    'promo.rule2': 'Puntos acreditados en 24 horas',
    'promo.rule3': 'Bonificación no reembolsable',
    'promo.rule4': 'Derechos de interpretación reservados',
    'promo.ctaButton': 'Recargar ahora',

    'forgot.phoneTitle': 'Restablecer contraseña',
    'forgot.phoneSubtitle': 'Ingrese su número de teléfono registrado',
    'forgot.phonePlaceholder': 'Número de teléfono',
    'forgot.sendCode': 'Enviar código',
    'forgot.codeTitle': 'Ingresar código',
    'forgot.codeSubtitle': 'Código enviado al teléfono que termina en {phone}',
    'forgot.verify': 'Verificar',
    'forgot.resend': 'Reenviar',
    'forgot.resendIn': 'Reenviar en {seconds}s',
    'forgot.successTitle': 'Verificado',
    'forgot.successSubtitle': 'Su contraseña temporal está abajo',
    'forgot.tempPassword': 'Contraseña temporal',
    'forgot.backToLogin': 'Volver al inicio de sesión',
    'forgot.error': 'Aviso',
    'forgot.invalidPhone': 'Ingrese un número válido',
    'forgot.invalidCode': 'Ingrese un código válido',

    'register.title': 'Crear cuenta',
    'register.subtitle': 'Únete y disfruta beneficios exclusivos',
    'register.namePlaceholder': 'Nombre completo',
    'register.phonePlaceholder': 'Número de teléfono',
    'register.passwordPlaceholder': 'Contraseña (mín 6 caracteres)',
    'register.confirmPasswordPlaceholder': 'Confirmar contraseña',
    'register.agreePrefix': 'Acepto los',
    'register.terms': 'Términos de servicio',
    'register.and': 'y',
    'register.privacy': 'Política de privacidad',
    'register.submit': 'Crear cuenta',
    'register.hasAccount': '¿Ya tienes cuenta?',
    'register.loginNow': 'Iniciar sesión',
    'register.error': 'Aviso',
    'register.nameRequired': 'Ingrese su nombre',
    'register.phoneInvalid': 'Ingrese un número válido',
    'register.passwordWeak': 'Contraseña mínimo 6 caracteres',
    'register.passwordMismatch': 'Las contraseñas no coinciden',
    'register.agreeRequired': 'Acepte los términos',
    'register.successTitle': 'Registro exitoso',
    'register.successMessage': 'Su ID de miembro se enviará por SMS',

    'notifications.title': 'Notificaciones',
    'notifications.settingsTitle': 'Configuración',
    'notifications.transactions': 'Transacciones',
    'notifications.promotions': 'Promociones',
    'notifications.announcements': 'Anuncios',
    'notifications.messages': 'Mensajes',
    'notifications.recentTitle': 'Recientes',
    'notifications.empty': 'Sin notificaciones',
    'notifications.item.promo.title': 'Oferta del día de miembros',
    'notifications.item.promo.desc': '¡Doble puntos en recargas los miércoles!',
    'notifications.item.transaction.title': 'Pago exitoso',
    'notifications.item.transaction.desc': 'Gastaste ¥128.00 en tienda',
    'notifications.item.system.title': 'Actualización del sistema',
    'notifications.item.system.desc': 'App actualizada a la última versión',

    'security.title': 'Seguridad',
    'security.accountSection': 'Cuenta',
    'security.loginPassword': 'Contraseña de acceso',
    'security.loginPasswordHint': 'Cambia tu contraseña regularmente',
    'security.paymentPassword': 'Contraseña de pago',
    'security.paymentPasswordDesc': 'Verificar identidad para pagos',
    'security.paymentPasswordHint': 'Establecer contraseña de 6 dígitos',
    'security.changePassword': 'Cambiar contraseña',
    'security.changePasswordHint': 'Visita tienda o contacta soporte',
    'security.privacySection': 'Privacidad',
    'security.biometric': 'Inicio biométrico',
    'security.biometricHint': 'Usar Face ID/huella',
    'security.hideBalance': 'Ocultar saldo',
    'security.hideBalanceHint': 'Ocultar saldo en pantalla principal',
    'security.devicesSection': 'Dispositivos',
    'security.linkedDevices': 'Dispositivos vinculados',
    'security.linkedDevicesDesc': 'Administrar dispositivos',
    'security.linkedDevicesHint': '1 dispositivo conectado',
    'security.tipText': 'La seguridad de tu cuenta es buena',

    'preferences.title': 'Preferencias',
    'preferences.displaySection': 'Pantalla',
    'preferences.darkMode': 'Modo oscuro',
    'preferences.language': 'Idioma',
    'preferences.soundSection': 'Sonido y vibración',
    'preferences.sound': 'Sonido',
    'preferences.vibration': 'Vibración',

    'stores.title': 'Tiendas cercanas',
    'stores.currentLocation': 'Ubicación actual: Shanghái',
    'stores.store1.name': 'Shí Miǎo Dào (Nanjing Rd)',
    'stores.store1.address': '100 Nanjing East Rd, Huangpu',
    'stores.store2.name': 'Shí Miǎo Dào (Lujiazui)',
    'stores.store2.address': '200 Lujiazui Ring Rd, Pudong',
    'stores.store3.name': 'Shí Miǎo Dào (Xujiahui)',
    'stores.store3.address': '300 Huashan Rd, Xuhui',
    'stores.call': 'Llamar',
    'stores.navigate': 'Navegar',

    'support.title': 'Soporte',
    'support.online': 'En línea',
    'support.welcomeMessage': '¡Hola! Soy el asistente de soporte. ¿Cómo puedo ayudarte?',
    'support.autoReply': 'Gracias por tu mensaje. Un representante te atenderá pronto...',
    'support.quickTitle': 'Preguntas rápidas',
    'support.quick.balance': '¿Cómo verificar saldo?',
    'support.quick.recharge': '¿Ofertas de recarga?',
    'support.quick.coupon': '¿Cómo usar cupones?',
    'support.quick.points': '¿Cómo canjear puntos?',
    'support.inputPlaceholder': 'Escribe tu mensaje...',

    'help.title': 'Centro de ayuda',
    'help.heroTitle': '¿Cómo podemos ayudar?',
    'help.heroSubtitle': 'Encuentra respuestas a preguntas comunes',
    'help.faqTitle': 'Preguntas frecuentes',
    'help.faq.recharge.q': '¿Cómo recargar?',
    'help.faq.recharge.a': 'Toca "Recargar" en inicio, selecciona monto y completa el pago. El saldo se acredita al instante.',
    'help.faq.coupon.q': '¿Cómo usar cupones?',
    'help.faq.coupon.a': 'Ve cupones disponibles en "Cupones". Muestra el código QR al cajero al pagar.',
    'help.faq.points.q': '¿Para qué son los puntos?',
    'help.faq.points.a': 'Los puntos se pueden canjear por cupones y regalos. Gana 1 punto por ¥1 gastado, más puntos bonus en recargas.',
    'help.faq.tier.q': '¿Cómo subir de nivel?',
    'help.faq.tier.a': 'Auto-actualización según gasto: Plata 0-999, Oro 1000-4999, Platino 5000-9999, Diamante 10000+.',
    'help.faq.password.q': '¿Olvidaste contraseña?',
    'help.faq.password.a': 'Toca "¿Olvidaste contraseña?" en inicio de sesión para restablecer por verificación telefónica.',
    'help.stillNeedHelp': '¿Aún necesitas ayuda?',
    'help.contactSupport': 'Contactar soporte',
  },
};

function formatMessage(template: string, params?: Record<string, string | number>) {
  if (!params) return template;
  return template.replace(/\{(\w+)\}/g, (_match, key: string) => {
    const value = params[key];
    return value === undefined ? `{${key}}` : String(value);
  });
}

export const [I18nProvider, useI18n] = createContextHook(() => {
  const [locale, setLocaleState] = useState<Locale>('zh');
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    let isMounted = true;
    (async () => {
      try {
        const stored = await AsyncStorage.getItem(LOCALE_STORAGE_KEY);
        if (!isMounted) return;
        if (stored === 'zh' || stored === 'en' || stored === 'es') {
          setLocaleState(stored);
        }
      } finally {
        if (isMounted) setIsLoading(false);
      }
    })();
    return () => {
      isMounted = false;
    };
  }, []);

  const setLocale = useCallback(async (next: Locale) => {
    setLocaleState(next);
    try {
      await AsyncStorage.setItem(LOCALE_STORAGE_KEY, next);
    } catch {
      // ignore
    }
  }, []);

  const toggleLocale = useCallback(async () => {
    const next: Locale = locale === 'zh' ? 'en' : locale === 'en' ? 'es' : 'zh';
    await setLocale(next);
  }, [locale, setLocale]);

  const t = useMemo(() => {
    return (key: string, params?: Record<string, string | number>) => {
      const message = MESSAGES[locale]?.[key] ?? MESSAGES.zh[key] ?? key;
      return formatMessage(message, params);
    };
  }, [locale]);

  return {
    locale,
    isLoading,
    setLocale,
    toggleLocale,
    t,
  };
});
